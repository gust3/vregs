<?php// Запрет прямого доступа.defined('_JEXEC') or die; // Подключаем библиотеку modellist Joomla.jimport('joomla.application.component.modellist'); /** * Модель списка сообщений компонента HelloWorld. */class gustVMtoolsModelShops extends JModelList{    /**     * Метод для построения SQL запроса для загрузки списка данных.     *     * @return string SQL запрос.     */    protected function getListQuery()    {        // Создаем новый query объект.        $db = JFactory::getDBO();        $query = $db->getQuery(true);         // Выбераем поля.        $query->select('id, name');         // Из таблицы helloworld.        $query->from('#__vmtools_shops');         return $query;    }	public function set_shops()	{		$db = JFactory::getDBO();		$query = 'SELECT * FROM products_maps';		$db->setQuery($query);		$info = $db->loadObjectList();					foreach ($info as $item)		{						if ($item->maps) 			{			$arr = explode(';', $item->maps);				foreach($arr as $item2)				{					$arr2 = explode(':', $item2);															if ($arr2[1])					{						if (count($arr2) == 4)						{							$ymname = $arr2[0].$arr2[1];							$ymnames[] = $ymname;						}						else						{							$ymname = $arr2[0];							$ymnames[] = $ymname;						}					}				}			}				}				$ymnames = array_unique($ymnames);		foreach ($ymnames as $item)			{							$query = 'INSERT INTO #__vmtools_netshop (ymname) VALUES ("'.$db->Quote($item).'")';				$db->setQuery($query);				$db->query();				}		$netproducts =& JTable::getInstance('netproducts', 'Table');				foreach ($info as $item)		{			$points = explode(';', $item->maps);						foreach ($points as $point)			{				$point_explode = explode(':', $point);				$query = 'SELECT * FROM #__vmtools_netshop WHERE ymname="'.$db->Quote($point_explode[0]).'"';				$db->setQuery($query);								if (!$point_explode[1])				{					continue;				}				$id_net = $db->loadObject();				unset($form);				$form['id'] = 0;				$form['id_net'] = $id_net->id;				$form['id_product'] = $item->id;				$form['price'] = $point_explode[2];				$form['published'] = 1;								$netproducts->bind($form);				$netproducts->check($form);				$netproducts->store($form, true);			}		}	}	}